<script
  src="https://maps.googleapis.com/maps/api/js?language=ja&region=JP&key=AIzaSyCi_3RzETS7tHokVtKrb2wpoHC7ovon2IE&callback=initMap"
  async defer>
</script>
<script>
  function initMap() {
    "use strict";
  var target = document.getElementById("target");
  let latitude = Number(document.getElementById("latitude").value);
  let longitude = Number(document.getElementById("longitude").value);
  let gps_fixed = document.getElementById("gps_fixed");
  let point =  { lat: latitude, lng: longitude};
  let map;
  let gps_marker = null;

  console.log(point);
  map = new google.maps.Map(target, {
    center: point,
    zoom: 17,
    mapTypeControl: false,
    zoomControl: true,
    streetViewControl: false,
    // disableDefaultUI: true,
    // zoomControl: true,
  });

  //マーカーをデフォルトセット
  marker = new google.maps.Marker({
    position: point,
    map: map,
    title: document.getElementById("restaurant_name").innerHTML,
    animation: google.maps.Animation.DROP,
  });

  // イベント
  gps_fixed.addEventListener('click', (event) => {
    console.log('clickイベント');
    if (!navigator.geolocation) {
        alert('GoogleのGeolocationサービスが使用できません。');
        return;
    };
    console.log('clickイベント２');
    navigator.geolocation.getCurrentPosition(function(position) {
      let lat = position.coords.latitude;
      let lng =  position.coords.longitude;
      let latlng = {lat: lat, lng: lng};
      let center_position = new google.maps.LatLng(lat,lng);
      console.log(latlng);

      map.setCenter(center_position)
      // アイコンクリア
      if (gps_marker !== null){
          gps_marker.setMap(null);
      };
      gps_marker = new google.maps.Marker({
        position: latlng,
        map: map,
        animation: google.maps.Animation.DROP,
        title: "現在地",
        // icon:{
        //   fillColor: "#0000ff", 
        // }
      });
    },
    function () {
    alert("現在地が取得できませんでした。");
    return;
    });
  });


  // var target = document.getElementById("target");
  // var geocoder = new google.maps.Geocoder();

  // geocoder.geocode(
  //   {
  //     address: document.getElementById("address").innerHTML
  //   },
  //   function (results, status) {
  //     if (status !== "OK") {
  //       alert("マップの取得に失敗しました。: " + status);
  //       document.getElementById('target').innerText ="地図情報が取得できません。";
  //       return;
  //     }
  //     // results[0].geometry.locationに緯度経度の情報が入ってくる
  //     if (results[0]) {
  //       let location = results[0].geometry.location;
  //       let restaurantmap = new google.maps.Map(target, {
  //         center: location,
  //         zoom: 17,
  //       });
  //       // 緯度経度の情報をハッシュに変換
  //       let lat = location.lat();
  //       let lng =  location.lng();
  //       let latlng = {lat: lat, lng: lng};
  //       var marker = new google.maps.Marker({
  //         position: latlng,
  //         map: restaurantmap,
  //         animation: google.maps.Animation.DROP,
  //         title: document.getElementById("restaurant_name").innerHTML
  //         });
  //       var infoWindow = new google.maps.InfoWindow({
  //         content: document.getElementById("restaurant_name").innerHTML
  //         });
  //         marker.addListener('click', function() {
  //           infoWindow.open(restaurantmap, marker);
  //         });

  //     } else {
  //       arert("マップが見つかりませんでした。");
  //       document.getElementById('target').innerText ="地図情報が取得できません。";
  //       return;
  //     }
  //   }
  // );

  };
</script>